import{r as d,h as V,aq as $,ar as q,as as z,j as o,k as G,c as k,b as M,at as N,au as U,av as W,m as K,aw as j,ax as h,ay as L,az as Q,aA as S,aB as w,aC as _,aD as H,aE as J,aF as X,U as x,ap as Y,$ as T,aj as Z,z as F,D,aG as tt,B as O,aH as et,ao as st,aI as at,an as it,P as ot,W as nt,aJ as B,aK as rt,aL as ct,E}from"./index-De8AI2Zv.js";import{u as lt}from"./useActivity-BlB7L5yS.js";import{S as dt}from"./SnackbarContext-Blu8L3Fz.js";import"./useUser-DpAKoteO.js";import"./index-BoNgdhHe.js";import"./useIsAuthenticated-e_Uob3F-.js";const ut=(t,e)=>{const{ownerState:a}=t;return[e.root,a.dense&&e.dense,a.alignItems==="flex-start"&&e.alignItemsFlexStart,a.divider&&e.divider,!a.disableGutters&&e.gutters]},pt=t=>{const{alignItems:e,classes:a,dense:l,disabled:s,disableGutters:r,divider:n,selected:v}=t,u=M({root:["root",l&&"dense",!r&&"gutters",n&&"divider",s&&"disabled",e==="flex-start"&&"alignItemsFlexStart",v&&"selected"]},N,a);return{...a,...u}},vt=G(U,{shouldForwardProp:t=>W(t)||t==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:ut})(K(({theme:t})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${h.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:j(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${h.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:j(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${h.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:j(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:j(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${h.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${h.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},variants:[{props:({ownerState:e})=>e.divider,style:{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:e})=>e.dense,style:{paddingTop:4,paddingBottom:4}}]}))),yt=d.forwardRef(function(e,a){const l=V({props:e,name:"MuiListItemButton"}),{alignItems:s="center",autoFocus:r=!1,component:n="div",children:v,dense:p=!1,disableGutters:u=!1,divider:b=!1,focusVisibleClassName:m,selected:C=!1,className:i,...c}=l,y=d.useContext($),g=d.useMemo(()=>({dense:p||y.dense||!1,alignItems:s,disableGutters:u}),[s,y.dense,p,u]),f=d.useRef(null);q(()=>{r&&f.current&&f.current.focus()},[r]);const A={...l,alignItems:s,dense:g.dense,disableGutters:u,divider:b,selected:C},I=pt(A),R=z(f,a);return o.jsx($.Provider,{value:g,children:o.jsx(vt,{ref:R,href:c.href||c.to,component:(c.href||c.to)&&n==="div"?"button":n,focusVisibleClassName:k(I.focusVisible,m),ownerState:A,className:k(I.root,i),...c,classes:I,children:v})})}),gt=L({title:S("Title"),description:S("Description"),category:S("Category"),date:Q({message:"Date is required"}),location:L({venue:S("Venue"),city:_().optional(),latitude:w(),longitude:w()})}),ft=[{value:"drinks",text:"Drinks"},{value:"travel",text:"Travel"},{value:"film",text:"Film"},{value:"culture",text:"Culture"},{value:"food",text:"Food"},{value:"music",text:"Music"}];function mt(t){const{field:e,fieldState:a}=H({...t}),[l,s]=d.useState(!1),[r,n]=d.useState([]),[v,p]=d.useState({}),u="https://api.locationiq.com/v1/autocomplete?key=pk.2bc12679f98b227a426aea1a5bd6660c&limit=5&dedupe=1&";d.useEffect(()=>{e.value&&typeof e.value=="object"?p(e.value.venue||""):p(e.value||"")},[e]);const b=d.useMemo(()=>J(async i=>{if(!i&&i.length<3){n([]);return}s(!0);try{const c=await X.get(`${u}q=${i}}`);n(c.data)}catch(c){console.error(c)}finally{s(!1)}},500),[u]),m=async i=>{e.onChange(i),await b(i)},C=i=>{const c=i.address?.city||i.address?.town||i.address?.village,y=i.display_name,g=i.lat,f=i.lon;p(y),e.onChange({city:c,venue:y,latitude:g,longitude:f}),n([])};return o.jsxs(x,{display:"flex",flexDirection:"column",gap:1,children:[o.jsx(Y,{...t,...e,value:v,onChange:i=>m(i.target.value),variant:"outlined",fullWidth:!0,error:!!a.error,helperText:a.error?.message}),l&&o.jsx(T,{size:"30px"}),r.length>0&&o.jsx(Z,{children:r.map((i,c)=>o.jsx(yt,{divider:!0,onClick:()=>C(i),children:i.display_name},c))})]})}const P=()=>{const t=d.useContext(dt);if(!t)throw new Error("useSnackbar must be used within a SnackbarProvider");return t},xt=()=>{const t=F(),{showSnackbar:e}=P(),{mutate:a,isPending:l,error:s}=D({mutationFn:async r=>await tt(r),onSuccess:async()=>{await t.invalidateQueries({queryKey:["activities"]}),e("Activity updated successfully!","success")},onError:r=>{e(`Error deleting activity: ${r.message}`,"error",5e3)}});return{updateActivity:a,isLoadingEditActivity:l,errorEditActivity:s}},bt=()=>{const t=F(),{showSnackbar:e}=P(),a=O(),{mutate:l,isPending:s,error:r}=D({mutationFn:n=>et(n),onSuccess:n=>{t.invalidateQueries({queryKey:["activities"]}),e("Activity created successfully!","success"),a(`/activities/${n}`)},onError:n=>{e(`Error creating activity: ${n.message}`,"error",5e3)}});return{addActivity:l,isLoadingAddActivity:s,errorAddActivity:r}};function $t(){const{handleSubmit:t,reset:e,control:a}=st({mode:"onTouched",resolver:at(gt)}),{id:l}=it(),{activity:s,activityLoading:r}=lt(l??""),{updateActivity:n,isLoadingEditActivity:v}=xt(),{addActivity:p,isLoadingAddActivity:u}=bt(),b=u||v,m=O();d.useEffect(()=>{s&&e({...s,location:{city:s.city,venue:s.venue,latitude:s.latitude,longitude:s.longitude}})},[s,e]);const C=i=>{const{location:c,...y}=i,g={...y,...c};try{s?n({...s,...g},{onSuccess:()=>{m(`/activities/${s.id}`)}}):p(g)}catch(f){console.log(f)}};return r?o.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:o.jsx(T,{})}):o.jsx(ot,{sx:{borderRadius:3},children:o.jsxs(x,{component:"form",sx:{p:2},onSubmit:t(C),children:[o.jsx(nt,{variant:"h6",gutterBottom:!0,sx:{textTransform:"uppercase",borderBottom:1,mb:2,borderColor:"divider"},fontWeight:"bold",color:"textSecondary",children:s?"Edit Activity":"Create Activity"}),o.jsxs(x,{display:"flex",flexDirection:"column",gap:1,children:[o.jsx(B,{id:"title-id",label:"Title",control:a,name:"title"}),o.jsxs(x,{display:"flex",gap:3,alignItems:"center",children:[o.jsx(rt,{id:"category-id",items:ft,name:"category",control:a,label:"Category"}),o.jsx(ct,{label:"Date",control:a,name:"date"})]}),o.jsx(B,{id:"description-id",label:"Description",control:a,name:"description",multiline:!0,rows:3}),o.jsx(mt,{label:"Location",name:"location",control:a})]}),o.jsxs(x,{sx:{mt:2,display:"flex",gap:1,justifyContent:"flex-end"},children:[o.jsx(E,{variant:"contained",sx:{textTransform:"uppercase"},color:"inherit",size:"medium",onClick:()=>m("/activities"),children:"Cancel"}),o.jsx(E,{sx:{textTransform:"uppercase"},variant:"contained",color:"success",size:"medium",type:"submit",disabled:b,children:"Save"})]})]})})}export{$t as default};
